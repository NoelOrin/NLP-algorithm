#coding='utf-8'
import pandas as pd
import re
import os

def extract(inpath):
    """æå–æ•°æ®"""
    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    if not os.path.exists(inpath):
        print(f"é”™è¯¯: æ–‡ä»¶ {inpath} ä¸å­˜åœ¨")
        return []
    
    try:
        # ä½¿ç”¨pandasè¯»å–Excelæ–‡ä»¶
        df = pd.read_excel(inpath)
        # æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„åˆ—
        if len(df.columns) < 5:
            print(f"é”™è¯¯: Excelæ–‡ä»¶éœ€è¦è‡³å°‘5åˆ—ï¼Œå½“å‰åªæœ‰{len(df.columns)}åˆ—")
            return []
        
        # æå–ç¬¬5åˆ—ï¼ˆç´¢å¼•4ï¼‰çš„æ•°æ®
        numbers = df.iloc[:, 4].dropna().tolist()
        print(f"æˆåŠŸè¯»å– {len(numbers)} æ¡æ•°æ®")
        return numbers
    except Exception as e:
        print(f"è¯»å–Excelæ–‡ä»¶å¤±è´¥: {e}")
        return []

def clean(line):
    """å¯¹ä¸€ä¸ªæ–‡ä»¶çš„æ•°æ®è¿›è¡Œæ¸…æ´—"""
    rep=['ã€ã€‘','ã€','ã€‘','ğŸ‘','ğŸ¤',
        'ğŸ®','ğŸ™','ğŸ‡¨ğŸ‡³','ğŸ‘','â¤ï¸','â€¦â€¦â€¦','ğŸ°','...ã€ã€','ï¼Œï¼Œ','..','ğŸ’ª','ğŸ¤“',
         'âš•ï¸','ğŸ‘©','ğŸ™ƒ','ğŸ˜‡','ğŸº','ğŸ‚','ğŸ™ŒğŸ»','ğŸ˜‚','ğŸ“–','ğŸ˜­','âœ§Ù©(ËŠÏ‰Ë‹*)Ùˆâœ§','ğŸ¦','ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ','//','ğŸ˜Š','ğŸ’°','ğŸ˜œ','ğŸ˜¯',
         '(áƒ¦Ë˜âŒ£Ë˜áƒ¦)','âœ§ï¼¼Ù©(ëˆˆà±ªëˆˆ)Ùˆ/ï¼âœ§','ğŸŒ','ğŸ€','ğŸ´',
         'ğŸŒ»','ğŸŒ±','ğŸŒ±','ğŸŒ»','ğŸ™ˆ','(à¸‡â€¢Ì€_â€¢Ì)à¸‡ï¼','ğŸ‰‘ï¸','ğŸ’©',
         'ğŸ','âŠ™âˆ€âŠ™ï¼','ğŸ™Š','ã€ï¼Ÿ','+1','ğŸ˜„','ğŸ™','ğŸ‘‡ğŸ»','ğŸ“š','ğŸ™‡',
         'ğŸ™‹','ï¼ï¼ï¼ï¼','ğŸ‰','ï¼¼(^â–½^)ï¼','ğŸ‘Œ','ğŸ†’','ğŸ»',
         'ğŸ™‰','ğŸµ','ğŸˆ','ğŸŠ','0371-12345','â˜•ï¸','ğŸŒ','ğŸ˜³','ğŸ‘»','ğŸ¶','ğŸ‘„','\U0001f92e\U0001f92e','ğŸ˜”','ï¼‹1','ğŸ›€','ğŸ¸','ğŸ·','â•1',
         'ğŸŒš','ï¼šï¼š','ğŸ’‰','âˆš','x','ï¼ï¼ï¼','ğŸ™…','â™‚ï¸','ğŸ’Š','ğŸ‘‹','o(^o^)o','mei\u2006sha\u2006shi','ğŸ’‰','ğŸ˜ª','ğŸ˜±',
         'ğŸ¤—','å…³æ³¨','â€¦â€¦','(((â•¹Ğ´â•¹;)))','âš ï¸','Ô¾â€¸Ô¾','â›½ï¸','ğŸ˜“','ğŸµ',
         'ğŸ™„ï¸','ğŸŒ•','â€¦','ğŸ˜‹','[]','[',']','â†’_â†’','ğŸ’','ğŸ˜¨','&quot;','ğŸ˜','à¸…Û¶â€¢ï»Œâ€¢â™¡','ğŸ˜°','ğŸ™ï¸',
         'ğŸ¤§','ğŸ˜«','(à¸‡â€¢Ì€_â€¢Ì)à¸‡','ğŸ˜','âœŠ','ğŸš¬','ğŸ˜¤','ğŸ‘»','ğŸ˜£','ï¼š','ğŸ˜·','(*^â–½^)/â˜…*â˜†','ğŸ','ğŸ”','ğŸ˜˜','ğŸ‹','(âœªâ–½âœª)','(âÂ´Ï‰`â)','1âƒ£3âƒ£','(^_^)ï¼','â˜€ï¸',
	     'ğŸ','ğŸ˜…','ğŸŒ¹','ğŸ ','â†’_â†’','ğŸ™‚','âœ¨','â„ï¸','â€¢','ğŸŒ¤','ğŸ’“','ğŸ”¨','ğŸ‘','ğŸ˜','âŠ™âˆ€âŠ™ï¼','ğŸ‘','âœŒ(Ì¿â–€Ì¿\u2009Ì¿Ä¹Ì¯Ì¿Ì¿â–€Ì¿Ì¿)âœŒ',
         'ğŸ˜Š','ğŸ‘†','ğŸ’¤','ğŸ˜˜','ğŸ˜Š','ğŸ˜´','ğŸ˜‰','ğŸŒŸ','â™¡â™ª..ğ™œğ™¤ğ™¤ğ™™ğ™£ğ™ğ™œğ™ğ™©â€¢Íˆá´—â€¢Íˆâœ©â€§â‚ŠËš','ğŸ‘ª','ğŸ’°','ğŸ˜','ğŸ€','ğŸ›','ğŸ–•ğŸ¼','ğŸ˜‚','(âœªâ–½âœª)','ğŸ‹','ğŸ…','ğŸ‘€','â™‚ï¸','ğŸ™‹ğŸ»','âœŒï¸','ğŸ¥³','ï¿£ï¿£)Ïƒ',
         'ğŸ˜’','ğŸ˜‰','ğŸ¦€','ğŸ’–','âœŠ','ğŸ’ª','ğŸ™„','ğŸ£','ğŸŒ¾','âœ”ï¸','ğŸ˜¡','ğŸ˜Œ','ğŸ”¥','â¤','ğŸ¼','ğŸ¤­','ğŸŒ¿','ä¸¨','âœ…','ğŸ¥','ï¾‰','â˜€','5âƒ£âº1âƒ£0âƒ£','ğŸš£','ğŸ£','ğŸ¤¯','ğŸŒº',
         'ğŸŒ¸',
         ]
    pattern_0=re.compile('#.*?#')#åœ¨ç”¨æˆ·åå¤„åŒ¹é…è¯é¢˜åç§°
    pattern_1=re.compile('ã€.*?ã€‘')#åœ¨ç”¨æˆ·åå¤„åŒ¹é…è¯é¢˜åç§°
    pattern_2=re.compile(r'è‚ºç‚@([\u4e00-\u9fa5\w\-]+)')#åŒ¹é…@
    pattern_3=re.compile(r'@([\u4e00-\u9fa5\w\-]+)')#åŒ¹é…@
    #è‚ºç‚@ç¯çƒæ—¶æŠ¥
    pattern_4=re.compile(u'[\U00010000-\U0010ffff\uD800-\uDBFF\uDC00-\uDFFF]')#åŒ¹é…è¡¨æƒ…
    # pattern_5=re.compile('(.*?)')#è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¼šåˆ é™¤æ‰€æœ‰å†…å®¹ï¼Œæ³¨é‡Šæ‰
    pattern_7=re.compile('L.*?çš„å¾®åšè§†é¢‘')
    pattern_8=re.compile('ï¼ˆ.*?ï¼‰')
    #pattern_9=re.compile(u"\|[\u4e00-\u9fa5]*\|")#åŒ¹é…ä¸­æ–‡

    line=line.replace('Oç½‘é¡µé“¾æ¥','')
    line=line.replace('-----','')
    line=line.replace('â‘ ','')
    line=line.replace('â‘¡','')
    line=line.replace('â‘¢','')
    line=line.replace('â‘£','')
    line=line.replace('>>','')
    line=re.sub(pattern_0, '', line,0) #å»é™¤è¯é¢˜
    line=re.sub(pattern_1, '', line,0) #å»é™¤ã€ã€‘
    line=re.sub(pattern_2, '', line,0) #å»é™¤@
    line=re.sub(pattern_3, '', line,0) #å»é™¤@
    line=re.sub(pattern_4, '', line,0) #å»é™¤è¡¨æƒ…
    # line=re.sub(pattern_5, '', line,0) #è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¼šåˆ é™¤æ‰€æœ‰å†…å®¹ï¼Œæ³¨é‡Šæ‰
    line=re.sub(pattern_7, '', line,0) 
    line=re.sub(pattern_8, '', line,0) 
    line=re.sub(r'\[\S+\]', '', line,0) #å»é™¤è¡¨æƒ…ç¬¦å·
    
    for i in rep:
        line=line.replace(i,'')
    return line


if __name__ == "__main__":
    names=["12"]
    
    # æ„å»ºæ­£ç¡®çš„æ–‡ä»¶è·¯å¾„
    script_dir = os.path.dirname(os.path.abspath(__file__))
    # ç›´æ¥ä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„dataæ–‡ä»¶å¤¹
    project_root = os.path.join(script_dir, '..', '..')
    data_dir = os.path.join(project_root, 'data')
    excel_file = os.path.join(data_dir, 'concat.xlsx')
    
    print(f"æ­£åœ¨æŸ¥æ‰¾Excelæ–‡ä»¶: {excel_file}")
    
    for name in names:
        numbers=extract(excel_file)#æ­£æ–‡
        if not numbers:
            print("æ²¡æœ‰è¯»å–åˆ°æ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ–‡ä»¶è·¯å¾„å’Œæ ¼å¼")
            continue
            
        output_file = os.path.join(script_dir, name+'.txt')
        f=open(output_file,'w',encoding='utf-8')
        for line in numbers:
            line=str(line)
            line=clean(line)
            f.write(line+'\n')
        f.close()
        print(f"æ•°æ®å·²ä¿å­˜åˆ°: {output_file}")


